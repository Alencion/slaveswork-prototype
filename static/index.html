<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8"/>
    <link rel="icon" href="./favicon.ico"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="theme-color" content="#000000"/>
    <meta name="description" content="Web site created using create-react-app"/>
    <link rel="apple-touch-icon" href="./logo192.png"/>
    <link rel="manifest" href="./manifest.json"/>
    <title>React App</title>
    <link href="./static/css/main.fb02b2fb.chunk.css" rel="stylesheet">
</head>

<body>
<noscript>You need to enable JavaScript to run this app.</noscript>
<div id="root"></div>
<script>!function (e) {
        function r(r) {
            for (var n, l, f = r[0], a = r[1], i = r[2], c = 0, s = []; c < f.length; c++) l = f[c], Object.prototype.hasOwnProperty.call(o, l) && o[l] && s.push(o[l][0]), o[l] = 0;
            for (n in a) Object.prototype.hasOwnProperty.call(a, n) && (e[n] = a[n]);
            for (p && p(r); s.length;) s.shift()();
            return u.push.apply(u, i || []), t()
        }

        function t() {
            for (var e, r = 0; r < u.length; r++) {
                for (var t = u[r], n = !0, f = 1; f < t.length; f++) {
                    var a = t[f];
                    0 !== o[a] && (n = !1)
                }
                n && (u.splice(r--, 1), e = l(l.s = t[0]))
            }
            return e
        }

        var n = {}, o = {1: 0}, u = [];

        function l(r) {
            if (n[r]) return n[r].exports;
            var t = n[r] = {i: r, l: !1, exports: {}};
            return e[r].call(t.exports, t, t.exports, l), t.l = !0, t.exports
        }

        l.m = e, l.c = n, l.d = function (e, r, t) {
            l.o(e, r) || Object.defineProperty(e, r, {enumerable: !0, get: t})
        }, l.r = function (e) {
            "undefined" != typeof Symbol && Symbol.toStringTag && Object.defineProperty(e, Symbol.toStringTag, {value: "Module"}), Object.defineProperty(e, "__esModule", {value: !0})
        }, l.t = function (e, r) {
            if (1 & r && (e = l(e)), 8 & r) return e;
            if (4 & r && "object" == typeof e && e && e.__esModule) return e;
            var t = Object.create(null);
            if (l.r(t), Object.defineProperty(t, "default", {
                enumerable: !0,
                value: e
            }), 2 & r && "string" != typeof e) for (var n in e) l.d(t, n, function (r) {
                return e[r]
            }.bind(null, n));
            return t
        }, l.n = function (e) {
            var r = e && e.__esModule ? function () {
                return e.default
            } : function () {
                return e
            };
            return l.d(r, "a", r), r
        }, l.o = function (e, r) {
            return Object.prototype.hasOwnProperty.call(e, r)
        }, l.p = "./";
        var f = this.webpackJsonpslaveswork_front = this.webpackJsonpslaveswork_front || [], a = f.push.bind(f);
        f.push = r, f = f.slice();
        for (var i = 0; i < f.length; i++) r(f[i]);
        var p = a;
        t()
    }([])</script>
<script src="./static/js/2.c369962a.chunk.js"></script>
<script src="./static/js/main.81b86ebe.chunk.js"></script>
</body>
<script type="text/javascript">
    window.onload = function () {
        var host = document.getElementById('host');
        console.log(host);

        // host page events
        host.addEventListener('click', async function () {
            await sleep(100);
            var start = document.getElementById("electron_start");
            var deviceListElement = document.getElementById("device_list");
            var deviceList = new Map()

            start.addEventListener('click', function () {
                console.log("starting host")
                astilectron.sendMessage("host", function (message) {
                    var token = document.getElementById("token");
                    token.innerText = message;
                });
            });

            console.log(document)

            // TODO Updating client information --> should be modify
            document.addEventListener('astilectron-ready', function () {
                // This will listen clients' update sent by GO
                astilectron.onMessage(function (message) {
                    // message is formed by JSON
                    var clientInfo = JSON.parse(message);
                    var name = clientInfo.Name;
                    var total = getTotalUsage(clientInfo.Usage);

                    if (!deviceList.prototype.has(clientInfo.Name)) {
                        deviceList = deviceList.prototype.set(name, total);
                        // create li element
                        makeDeviceElement(deviceListElement, name, total);
                    } else {
                        deviceList = deviceList.prototype.set(name, total);
                        // change innerText of current li element
                        document.getElementById(name).innerText = total;
                    }
                });
            });
        });

        var client = document.getElementById('client');
        console.log(client);

        // client page events
        client.addEventListener('click', async function () {
            await sleep(100);
            var submit = document.getElementById("client_submit");

            submit.addEventListener('click', function () {
                var token = document.getElementsByClassName("client_token").item(0);
                astilectron.sendMessage(token.value, function (message) {
                    console.log(message);
                });
            });
        });
    };

    function sleep(ms) {
        return new Promise(resolve => setTimeout(resolve, ms));
    }

    function makeDeviceElement(deviceListElement, name, total) {
        // TODO create li element --> make it function
        var deviceElement = document.createElement('li');
        deviceElement.id = name;

        var deviceName = document.createElement('p');
        deviceName.className = "device_name";
        deviceName.innerText = name;

        var deviceStatus = document.createElement('p');
        deviceStatus.className = "device_status";
        deviceStatus.innerText = total;

        deviceElement.appendChild(deviceName);
        deviceElement.appendChild(deviceStatus);

        deviceListElement.appendChild(deviceElement);
    }

    function getTotalUsage(usages) {
        var tUsages = usages;
        return tUsages.reduce((a, b) => a + b, 0);
    }
</script>
</script>

</html>